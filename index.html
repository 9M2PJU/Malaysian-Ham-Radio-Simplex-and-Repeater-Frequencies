<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malaysian Ham Radio Repeaters</title>
  <link rel="icon" href="https://pass.hamradio.my/favicon.ico" type="image/x-icon">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans leading-normal tracking-wide">

  <header class="bg-white shadow p-4">
    <h1 class="text-2xl font-bold text-center">ðŸ‡²ðŸ‡¾ Malaysian Ham Radio Repeater & Simplex Frequencies</h1>
  </header>

  <main class="max-w-5xl mx-auto p-4" id="output">
    <p class="text-center text-sm text-gray-600 mb-4">Loading data from <code>9M2PJU.csv</code>...</p>
  </main>

  <footer class="text-center text-sm text-gray-500 mt-8 mb-4">
    Made for ðŸ‡²ðŸ‡¾ by <a href="https://hamradio.my" class="underline text-blue-600">9M2PJU</a>
  </footer>

  <script>
    const output = document.getElementById('output');
    let currentSection = null;

    function createSection(title) {
      const section = document.createElement('section');
      section.className = "bg-white rounded-xl shadow-md p-4 mb-6";

      const heading = document.createElement('h2');
      heading.className = "text-xl font-semibold mb-3 border-b pb-1";
      heading.textContent = title;
      section.appendChild(heading);

      const table = document.createElement('table');
      table.className = "w-full text-sm table-auto";
      table.innerHTML = `
        <thead>
          <tr class="text-left border-b">
            <th class="py-1">Name</th>
            <th>Freq</th>
            <th>Offset</th>
            <th>Tone</th>
            <th>Mode</th>
            <th class="hidden md:table-cell">Comment</th>
          </tr>
        </thead>
        <tbody></tbody>
      `;
      section.appendChild(table);

      output.appendChild(section);
      return table.querySelector('tbody');
    }

    Papa.parse("9M2PJU.csv", {
      download: true,
      header: true,
      complete: function(results) {
        let tbody = null;
        results.data.forEach(row => {
          const loc = row.Location?.trim().toUpperCase();

          // Detect section header by known state code (KL, PHG, etc.)
          if (/^[A-Z]{2,6}$/.test(loc)) {
            tbody = createSection(loc);
            return;
          }

          if (!tbody) return; // skip if no section defined yet

          const tr = document.createElement('tr');
          tr.className = "border-t hover:bg-gray-50";

          tr.innerHTML = `
            <td class="py-1">${row.Name || ''}</td>
            <td>${row.Frequency || ''}</td>
            <td>${row.Offset || ''}</td>
            <td>${row.Tone || ''}</td>
            <td>${row.Mode || ''}</td>
            <td class="hidden md:table-cell">${row.Comment || ''}</td>
          `;
          tbody.appendChild(tr);
        });

        if (!output.querySelector('section')) {
          output.innerHTML = '<p class="text-center text-red-600">No data loaded. Please check your CSV format.</p>';
        }
      }
    });
  </script>
</body>
</html>
